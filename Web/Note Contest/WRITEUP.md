# –ö–æ–Ω–∫—É—Ä—Å –∑–∞–º–µ—Ç–æ–∫ | medium | web

## –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

> –ü—Ä–∏–º–∏ —É—á–∞—Å—Ç–∏–µ –≤ –∫–æ–Ω–∫—É—Ä—Å–µ! üéâ –û–ø—É–±–ª–∏–∫—É–π —Å–≤–æ—é –∑–∞–º–µ—Ç–∫—É –∏ –ø–æ–ø—Ä–æ–±—É–π —É–≥–∞–¥–∞—Ç—å –µ—ë –Ω–æ–º–µ—Ä. –ï—Å–ª–∏ —Ç—ã –Ω–∞–∑–æ–≤—ë—à—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –¥–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, –ø–æ–±–µ–¥–∞ –±—É–¥–µ—Ç –∑–∞ —Ç–æ–±–æ–π! –ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ—é –∏–Ω—Ç—É–∏—Ü–∏—é –∏ —É–¥–∞—á—É! üî¢‚ú®

## –í—ã–¥–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
[—Å—Å—ã–ª–∫–∞](http://tasks.polyctf.ru:30008/)

## –û–ø–∏—Å–∞–Ω–∏–µ
Lfi –≤ /api/notes/download?id= –∏ /api/notes/list?dir=/ —á–µ—Ä–µ–∑ double url encode -> —Å—É—Ä—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -> —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É—è–∑–≤–∏–º–æ—Å—Ç–∏ —Ä–∞–Ω–¥–æ–º–∞ –Ω–∞ Java

## –†–µ—à–µ–Ω–∏–µ
–ò–∑—É—á–∏–≤ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–º–µ—Ç–æ–∫ –Ω–∞–π–¥–µ–º —Å–ª–µ–¥—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: `/api/notes?id=` `/api/notes/list?dir=/`,  –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏—Ö —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ `/api/notes/download?id=`, —ç—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —É—è–∑–≤–∏–º—ã –∫ LFI. 

–ü–æ–ø—Ä–æ–±–æ–≤–∞–≤ –ø–µ—Ä–µ–π—Ç–∏ –ø–æ `/api/notes/list?dir=/..` –ø–æ–ª—É—á–∏–º –æ—à–∏–±–∫—É 
>Disallowed characters in note ID

–ó–∞—ç–Ω–∫–æ–¥–∏–≤ `.` –∫–∞–∫ `%252e` (double url encode) (. -> %2e, % -> %25) –ø–æ–ª—É—á–∏–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ –∑–∞–º–µ—Ç–æ–∫.

–ü—Ä–æ—Å–µ—Ä—á–∏–≤ —Ñ–∞–π–ª—ã –Ω–∞–π–¥–µ–º /app/app.jar –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –ø–æ `/api/notes/download?id=%252e%252e/%252e%252e/app/app%252ejar`

–†–∞–∑–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–≤ [app.jar](/solve/app.jar) –∏ –¥–µ–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–≤ –¥–∂–∞–≤–∞ –∫–ª–∞—Å—Å—ã –Ω–∞–π–¥–µ–º –∫–∞–∫ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∑–∞–º–µ—Ç–∫–∏

```java
private final Random random = new Random();
...
public ResponseEntity<String> createNote(@RequestBody Map<String, String> noteRequest) throws IOException {
	...
	String id = noteRequest.get("id");
	...
	String filename = String.valueOf(random.nextInt());
	...
	if (id != null && id.equals(filename)) {  
	    String flag = System.getenv("FLAG");  
	    responseJson.put("flag", flag != null ? flag : ""); 
	} 
}
```

–ü–æ–≥—É–≥–ª–∏–≤ –ø—Ä–æ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ —Ä–∞–Ω–¥–æ–º–∞ –≤ –î–∂–∞–≤–µ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –º–Ω–æ–≥–æ —Å—Ç–∞—Ç–µ–π –≤ –∫–æ—Ç–æ—Ä—ã—Ö —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —ç–∫—Å–ø–ª–æ–∏—Ç [—Ç—ã–∫.](https://habr.com/ru/articles/151187/) [—Ç—ã–∫.](https://xakep.ru/2015/07/20/java-random-hack/)

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–ª–∞–≥–∞ –Ω—É–∂–Ω–æ –≤–∑—è—Ç—å –¥–≤–∞ id –∑–∞–º–µ—Ç–æ–∫ –∏–¥—É—â–∏—Ö –¥—Ä—É–≥ –∑–∞ –¥—Ä—É–≥–æ–º, –∏ —Å –∏—Ö –ø–æ–º–æ—â—å—é –ø–æ–ª—É—á–∏—Ç—å seed –¥–ª—è Random. –ó–Ω–∞—è seed –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –Ω–æ–º–µ—Ä–∞ –∑–∞–ø–∏—Å–æ–∫.

–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç–∫—Å–ø–ª–æ–∏—Ç–∞ –µ—Å—Ç—å –≤ `./solve` [(–≤–∑—è—Ç –∏–∑ —á–∞—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ PolyCTF)](https://t.me/c/1996175205/1914)

![flag.jpg](solve/flag.jpg)

## –§–ª–∞–≥
`PolyCTF{R4nd0m_1s_n0t_S3cUr3_1n_J4vA}`
